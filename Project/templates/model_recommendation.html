<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Recommendations</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Recommended Movies</h1>
        <div id="movieContainer">
            <p>Loading movies...</p>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            try {
                const movies = {{ movie_data | tojson }};
                const trailerkeys = {{trailer_keys|tojson}} ;
                const movieContainer = document.getElementById("movieContainer");
                movieContainer.innerHTML = "";

                if (!movies || movies.length === 0) {
                    movieContainer.innerHTML = "<p>No matching movies found.</p>";
                    return;
                }
                let ct = 0;
                movies.forEach(movie => {
                    const movieDiv = document.createElement("div");
                    movieDiv.classList.add("movie-item");
                    movieDiv.innerHTML = `<p><strong>${movie.title}</strong> (${movie.release_date || 'N/A'}) - ‚≠ê ${movie.popularity || 'N/A'}</p>`;
                    
                    // Display trailer if available
                    if (trailerkeys[ct]) {
                        const trailerIframe = document.createElement("iframe");
                        trailerIframe.width = "560";
                        trailerIframe.height = "315";
                        trailerIframe.src = `https://www.youtube.com/embed/${trailerkeys[ct]}`;
                        trailerIframe.frameBorder = "0";
                        trailerIframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                        trailerIframe.allowFullscreen = true;
                        movieDiv.appendChild(trailerIframe);
                    }

                    movieContainer.appendChild(movieDiv);
                    ct++;
                });

            } catch (error) {
                console.error("Error fetching movies:", error);
                document.getElementById("movieContainer").innerHTML = `<p class="error-message">Error fetching movies. Please try again later.</p>`;
            }
        });
    </script>
</body>
</html>
